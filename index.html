<!DOCTYPE html>
<html>
<head>
    <style>
        .container {
            width: 900px;
            height: 506px;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
            border: 2px solid #333;
        }

        .tetris-piece {
            position: absolute;
            background-image: url('PP.jpg');
            background-size: 900px 506px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        button {
            display: block;
            margin: 10px auto;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container" id="puzzleContainer"></div>
    <button id="stopBtn">STOP</button>

    <svg width="0" height="0">
        <!-- Tetris Clip-Paths -->
        <clipPath id="I-shape">
            <rect width="100" height="25"/>
        </clipPath>
        <clipPath id="T-shape">
            <path d="M0,0 L100,0 L100,25 L70,25 L70,50 L30,50 L30,25 L0,25 Z"/>
        </clipPath>
        <clipPath id="L-shape">
            <path d="M0,0 L75,0 L75,50 L25,50 L25,25 L0,25 Z"/>
        </clipPath>
        <clipPath id="O-shape">
            <rect width="50" height="50"/>
        </clipPath>
        <clipPath id="line-shape">
            <rect width="150" height="25"/>
        </clipPath>
    </svg>

    <script>
        const TETRIS_CONFIG = [
            {type: 'I', width: 100, height: 25, rows: 1, cols: 4},
            {type: 'T', width: 100, height: 50, rows: 2, cols: 3},
            {type: 'L', width: 75, height: 50, rows: 2, cols: 2},
            {type: 'O', width: 50, height: 50, rows: 1, cols: 1},
            {type: 'line', width: 150, height: 25, rows: 1, cols: 6}
        ];

        const container = document.getElementById('puzzleContainer');
        let animationActive = true;
        let pieces = [];

        function initializePuzzle() {
            // Δημιουργία τυχαίου Tetris grid
            let occupied = Array(10).fill().map(() => Array(18).fill(false));
            
            TETRIS_CONFIG.forEach(config => {
                for(let i=0; i<5; i++) { // Προσθήκη 5 κομματιών από κάθε τύπο
                    let placed = false;
                    while(!placed) {
                        const row = Math.floor(Math.random() * (10 - config.rows));
                        const col = Math.floor(Math.random() * (18 - config.cols));
                        
                        if(canPlace(occupied, row, col, config.rows, config.cols)) {
                            placePiece(occupied, row, col, config);
                            placed = true;
                        }
                    }
                }
            });
        }

        function canPlace(grid, row, col, rows, cols) {
            for(let r=row; r<row+rows; r++) {
                for(let c=col; c<col+cols; c++) {
                    if(grid[r][c]) return false;
                }
            }
            return true;
        }

        function placePiece(grid, row, col, config) {
            const piece = document.createElement('div');
            piece.className = 'tetris-piece';
            piece.style.width = `${config.width}px`;
            piece.style.height = `${config.height}px`;
            piece.style.clipPath = `url(#${config.type}-shape)`;
            piece.style.left = `${col * 50}px`;
            piece.style.top = `${row * 50.6}px`;
            piece.dataset.finalX = col * 50;
            piece.dataset.finalY = row * 50.6;
            
            // Background positioning
            piece.style.backgroundPosition = `-${col * 50}px -${row * 50.6}px`;
            
            container.appendChild(piece);
            pieces.push(piece);

            for(let r=row; r<row+config.rows; r++) {
                for(let c=col; c<col+config.cols; c++) {
                    grid[r][c] = true;
                }
            }
        }

        async function animationCycle() {
            while(animationActive) {
                // Φάση 1: Προβολή πλήρης εικόνας για 2s
                container.style.backgroundImage = "url('PP.jpg')";
                await new Promise(r => setTimeout(r, 2000));
                container.style.backgroundImage = "none";

                // Φάση 2: Ακαριαία εξαφάνιση κομματιών
                pieces.forEach(piece => {
                    piece.style.transition = 'none';
                    piece.style.transform = `translateY(-100vh)`;
                    piece.style.opacity = '0';
                });
                await new Promise(r => requestAnimationFrame(r));

                // Φάση 3: Σπειροειδής εισαγωγή
                for(let i = pieces.length - 1; i >= 0; i--) {
                    const piece = pieces[i];
                    const startX = piece.dataset.finalX - 100 + Math.random() * 200;
                    
                    piece.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                    piece.style.transform = `translate(${startX}px, -100vh)`;
                    piece.style.opacity = '1';
                    
                    setTimeout(() => {
                        piece.style.transform = `translate(0,0)`;
                    }, 100);
                    
                    await new Promise(r => setTimeout(r, 50));
                }

                // Φάση 4: Παύση 2s
                await new Promise(r => setTimeout(r, 2000));
            }
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            animationActive = false;
            container.style.backgroundImage = "none";
            pieces.forEach(p => p.remove());
        });

        window.onload = () => {
            initializePuzzle();
            animationCycle();
        };
    </script>
</body>
</html>
