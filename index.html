<!DOCTYPE html>
<html>
<head>
    <style>
        .container {
            width: 900px;
            height: 506px;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
            border: 2px solid #333;
        }

        .puzzle-piece {
            width: 50px;
            height: 50.6px;
            position: absolute;
            background-image: url('PP.jpg');
            background-size: 900px 506px;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        button {
            display: block;
            margin: 10px auto;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container" id="puzzleContainer"></div>
    <button id="stopBtn">STOP</button>

    <script>
        const COLS = 18;
        const ROWS = 10;
        const PIECE_WIDTH = 50;
        const PIECE_HEIGHT = 50.6;
        let animationActive = true;
        let animationQueue = [];

        function createPuzzle() {
            const container = document.getElementById('puzzleContainer');
            container.innerHTML = '';

            // Δημιουργία κομματιών με αρχικές θέσεις
            for(let row = 0; row < ROWS; row++) {
                for(let col = 0; col < COLS; col++) {
                    const piece = document.createElement('div');
                    piece.className = 'puzzle-piece';
                    piece.style.backgroundPosition = `-${col*PIECE_WIDTH}px -${row*PIECE_HEIGHT}px`;
                    piece.style.transform = `translate(${col*PIECE_WIDTH}px, ${row*PIECE_HEIGHT}px)`;
                    piece.dataset.targetX = col*PIECE_WIDTH;
                    piece.dataset.targetY = row*PIECE_HEIGHT;
                    container.appendChild(piece);
                }
            }
            startAnimationCycle();
        }

        async function startAnimationCycle() {
            while(animationActive) {
                // Φάση 1: Όλα τα κομμάτια βγαίνουν εκτός οθόνης
                await exitAllPieces();
                
                // Φάση 2: Επιστροφή με σπειροειδή κίνηση
                await enterAllPieces();
                
                // Παύση 2s
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
        }

        async function exitAllPieces() {
            const pieces = Array.from(document.querySelectorAll('.puzzle-piece'));
            const exitDuration = 1000; // 1s ανά κομμάτι
            
            // Ταξινόμηση ανά row (πάνω πρώτα)
            pieces.sort((a,b) => parseFloat(a.dataset.targetY) - parseFloat(b.dataset.targetY));
            
            for(const [index, piece] of pieces.entries()) {
                const delay = index * 50; // Χρονική διαφορά 50ms ανά κομμάτι
                await new Promise(resolve => setTimeout(resolve, delay));
                piece.style.transform = `translate(${Math.random()*window.innerWidth}px, ${-window.innerHeight}px)`;
            }
            await new Promise(resolve => setTimeout(resolve, exitDuration));
        }

        async function enterAllPieces() {
            const pieces = Array.from(document.querySelectorAll('.puzzle-piece'));
            const enterDuration = 1500;
            
            // Ταξινόμηση ανά row (κάτω πρώτα)
            pieces.sort((a,b) => parseFloat(b.dataset.targetY) - parseFloat(a.dataset.targetY));
            
            for(const [index, piece] of pieces.entries()) {
                const initialX = parseFloat(piece.dataset.targetX) + (Math.random() - 0.5) * 1000;
                const initialY = -100 - Math.random() * 500;
                
                // Αρχική θέση εκτός οθόνης
                piece.style.transform = `translate(${initialX}px, ${initialY}px)`;
                
                // Κίνηση με καθυστέρηση
                setTimeout(() => {
                    piece.style.transform = `translate(${piece.dataset.targetX}px, ${piece.dataset.targetY}px)`;
                }, index * 50);
            }
            await new Promise(resolve => setTimeout(resolve, enterDuration));
        }

        document.getElementById('stopBtn').addEventListener('click', () => {
            animationActive = false;
        });

        window.onload = createPuzzle;
    </script>
</body>
</html>
