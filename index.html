<!DOCTYPE html>
<html>
<head>
    <title>Διορθωμένη Αυτοκατάλυση</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
</head>
<body>
    <div id="plot"></div>
    
    <div style="padding: 20px;">
        <label>A₀: <input type="number" id="A0" value="0.1" step="0.01"> M</label>
        <label>k: <input type="number" id="k" value="0.2" step="0.01"> M⁻¹s⁻¹</label>
        <label>C₀ (Κόκκινη): <input type="number" id="C0_red" value="0.001" step="0.001"> M</label>
        <label>C₀ (Πράσινη): <input type="number" id="C0_green" value="0.1" step="0.01"> M</label>
        <label>Μέγιστος Χρόνος: <input type="number" id="tMax" value="500" step="100"> s</label>
        <button onclick="updatePlot()">Ενημέρωση</button>
    </div>

    <script>
        const dt = 1;  // Αυξημένο βήμα χρόνου για μείωση δεδομένων

        // Βοηθητική συνάρτηση για εύρεση μέγιστης τιμής χωρίς spread operator
        function findMax(arr) {
            let max = -Infinity;
            for (let i = 0; i < arr.length; i++) {
                if (arr[i] > max) max = arr[i];
            }
            return max;
        }

        function simulate(A0, C0_auto, C0_red, C0_green, k, tMax) {
            let A_auto = A0, B_auto = C0_auto;
            let A_red = A0, B_red = C0_red;
            let A_green = A0, B_green = C0_green;
            
            const t = [], conc_auto = [], conc_red = [], conc_green = [];
            const rate_auto = [], rate_red = [], rate_green = [];
            
            for(let step=0; step*dt <= tMax; step++) {
                // Αυτοκατάλυση
                const rateAuto = k * A_auto * B_auto;
                A_auto = Math.max(A_auto - rateAuto * dt, 0);
                B_auto += rateAuto * dt;
                
                // Κόκκινη
                const rateRed = k * A_red * B_red;
                A_red = Math.max(A_red - rateRed * dt, 0);
                B_red += rateRed * dt;
                
                // Πράσινη
                const rateGreen = k * A_green * B_green;
                A_green = Math.max(A_green - rateGreen * dt, 0);
                B_green += rateGreen * dt;
                
                t.push(step*dt);
                conc_auto.push(A_auto);
                conc_red.push(A_red);
                conc_green.push(A_green);
                rate_auto.push(rateAuto);
                rate_red.push(rateRed);
                rate_green.push(rateGreen);
            }
            
            return { t, conc_auto, conc_red, conc_green, rate_auto, rate_red, rate_green };
        }

        function updatePlot() {
            // Προεπιλογή για μη έγκυρες τιμές
            const A0 = parseFloat(document.getElementById('A0').value) || 0.1;
            const k = parseFloat(document.getElementById('k').value) || 0.2;
            const C0_red = parseFloat(document.getElementById('C0_red').value) || 0.001;
            const C0_green = parseFloat(document.getElementById('C0_green').value) || 0.1;
            const tMax = parseFloat(document.getElementById('tMax').value) || 500;
            const C0_auto = 1e-9;
            
            const { t, conc_auto, conc_red, conc_green, rate_auto, rate_red, rate_green } = 
                simulate(A0, C0_auto, C0_red, C0_green, k, tMax);
            
            // Κανονικοποίηση ταχυτήτων με βοηθητική συνάρτηση
            const maxRate = Math.max(
                findMax(rate_auto),
                findMax(rate_red),
                findMax(rate_green)
            );
            
            const normalize = arr => maxRate > 0 ? arr.map(x => x/maxRate) : arr;

            const traces = [
                { x: t, y: conc_auto, name: 'Αυτοκατάλυση', line: { color: 'blue' } },
                { x: t, y: normalize(rate_auto), name: 'Ταχύτητα Αυτοκατάλυσης', yaxis: 'y2', line: { color: 'blue', dash: 'dot' } },
                { x: t, y: conc_red, name: `Κατάλυση (C₀=${C0_red}M)`, line: { color: 'red' } },
                { x: t, y: normalize(rate_red), name: 'Ταχύτητα Κόκκινης', yaxis: 'y2', line: { color: 'red', dash: 'dot' } },
                { x: t, y: conc_green, name: `Κατάλυση (C₀=${C0_green}M)`, line: { color: 'green' } },
                { x: t, y: normalize(rate_green), name: 'Ταχύτητα Πράσινης', yaxis: 'y2', line: { color: 'green', dash: 'dot' } }
            ];

            Plotly.react('plot', traces, {
                title: `Σύγκριση (Μέγ. Χρόνος: ${tMax}s)`,
                xaxis: { title: 'Χρόνος (s)', range: [0, tMax] },
                yaxis: { title: '[MnO₄⁻] (M)', range: [0, A0] },
                yaxis2: {
                    title: 'Κανονικοποιημένη Ταχύτητα',
                    overlaying: 'y',
                    side: 'right',
                    range: [0, 1.1]
                },
                showlegend: true
            });
        }

        // Αρχική φόρτωση
        updatePlot();
    </script>
</body>
</html>
